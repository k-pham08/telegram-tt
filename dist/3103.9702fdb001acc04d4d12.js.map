{"version":3,"file":"3103.9702fdb001acc04d4d12.js","mappings":"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","sources":["webpack://telegram-t/./src/components/ui/Modal.tsx","webpack://telegram-t/./src/util/trapFocus.ts","webpack://telegram-t/./src/components/ui/Portal.ts","webpack://telegram-t/./src/hooks/useLayoutEffectWithPrevDeps.ts","webpack://telegram-t/./src/util/captureKeyboardListeners.ts","webpack://telegram-t/./src/util/directInputManager.ts"],"sourcesContent":["import type { RefObject } from 'react';\nimport type { FC, TeactNode } from '../../lib/teact/teact';\nimport React, { useEffect, useRef } from '../../lib/teact/teact';\n\nimport type { TextPart } from '../../types';\n\nimport captureKeyboardListeners from '../../util/captureKeyboardListeners';\nimport trapFocus from '../../util/trapFocus';\nimport buildClassName from '../../util/buildClassName';\nimport { enableDirectTextInput, disableDirectTextInput } from '../../util/directInputManager';\nimport { dispatchHeavyAnimationEvent } from '../../hooks/useHeavyAnimationCheck';\n\nimport useLastCallback from '../../hooks/useLastCallback';\nimport useShowTransition from '../../hooks/useShowTransition';\nimport useLayoutEffectWithPrevDeps from '../../hooks/useLayoutEffectWithPrevDeps';\nimport useLang from '../../hooks/useLang';\nimport useHistoryBack from '../../hooks/useHistoryBack';\n\nimport Button from './Button';\nimport Portal from './Portal';\n\nimport './Modal.scss';\n\nconst ANIMATION_DURATION = 200;\n\ntype OwnProps = {\n  title?: string | TextPart[];\n  className?: string;\n  isOpen?: boolean;\n  header?: TeactNode;\n  isSlim?: boolean;\n  hasCloseButton?: boolean;\n  noBackdrop?: boolean;\n  noBackdropClose?: boolean;\n  children: React.ReactNode;\n  style?: string;\n  onClose: () => void;\n  onCloseAnimationEnd?: () => void;\n  onEnter?: () => void;\n  dialogRef?: RefObject<HTMLDivElement>;\n};\n\ntype StateProps = {\n  shouldSkipHistoryAnimations?: boolean;\n};\n\nconst Modal: FC<OwnProps & StateProps> = ({\n  dialogRef,\n  title,\n  className,\n  isOpen,\n  isSlim,\n  header,\n  hasCloseButton,\n  noBackdrop,\n  noBackdropClose,\n  children,\n  style,\n  onClose,\n  onCloseAnimationEnd,\n  onEnter,\n  shouldSkipHistoryAnimations,\n}) => {\n  const {\n    shouldRender,\n    transitionClassNames,\n  } = useShowTransition(\n    isOpen, onCloseAnimationEnd, shouldSkipHistoryAnimations, undefined, shouldSkipHistoryAnimations,\n  );\n  // eslint-disable-next-line no-null/no-null\n  const modalRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    if (!isOpen) {\n      return undefined;\n    }\n\n    disableDirectTextInput();\n\n    return enableDirectTextInput;\n  }, [isOpen]);\n\n  const handleEnter = useLastCallback((e: KeyboardEvent) => {\n    if (!onEnter) {\n      return false;\n    }\n\n    e.preventDefault();\n    onEnter();\n    return true;\n  });\n\n  useEffect(() => (\n    isOpen ? captureKeyboardListeners({ onEsc: onClose, onEnter: handleEnter }) : undefined\n  ), [isOpen, onClose, handleEnter]);\n  useEffect(() => (isOpen && modalRef.current ? trapFocus(modalRef.current) : undefined), [isOpen]);\n\n  useHistoryBack({\n    isActive: isOpen,\n    onBack: onClose,\n  });\n\n  useLayoutEffectWithPrevDeps(([prevIsOpen]) => {\n    document.body.classList.toggle('has-open-dialog', Boolean(isOpen));\n\n    if (isOpen || (!isOpen && prevIsOpen !== undefined)) {\n      dispatchHeavyAnimationEvent(ANIMATION_DURATION);\n    }\n\n    return () => {\n      document.body.classList.remove('has-open-dialog');\n    };\n  }, [isOpen]);\n\n  const lang = useLang();\n\n  if (!shouldRender) {\n    return undefined;\n  }\n\n  function renderHeader() {\n    if (header) {\n      return header;\n    }\n\n    if (!title) {\n      return undefined;\n    }\n\n    return (\n      <div className=\"modal-header\">\n        {hasCloseButton && (\n          <Button\n            round\n            color=\"translucent\"\n            size=\"smaller\"\n            ariaLabel={lang('Close')}\n            onClick={onClose}\n          >\n            <i className=\"icon icon-close\" />\n          </Button>\n        )}\n        <div className=\"modal-title\">{title}</div>\n      </div>\n    );\n  }\n\n  const fullClassName = buildClassName(\n    'Modal',\n    className,\n    transitionClassNames,\n    noBackdrop && 'transparent-backdrop',\n    isSlim && 'slim',\n  );\n\n  return (\n    <Portal>\n      <div\n        ref={modalRef}\n        className={fullClassName}\n        tabIndex={-1}\n        role=\"dialog\"\n      >\n        <div className=\"modal-container\">\n          <div className=\"modal-backdrop\" onClick={!noBackdropClose ? onClose : undefined} />\n          <div className=\"modal-dialog\" ref={dialogRef}>\n            {renderHeader()}\n            <div className=\"modal-content custom-scroll\" style={style}>\n              {children}\n            </div>\n          </div>\n        </div>\n      </div>\n    </Portal>\n  );\n};\n\nexport default Modal;\n","export default function trapFocus(element: HTMLElement) {\n  function handleKeyDown(e: KeyboardEvent) {\n    if (e.key !== 'Tab') {\n      return;\n    }\n\n    e.preventDefault();\n    e.stopPropagation();\n\n    const focusableElements = Array.from(\n      element.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'),\n    ) as HTMLElement[];\n    if (!focusableElements.length) {\n      return;\n    }\n\n    const currentFocusedIndex = focusableElements.findIndex((em) => em.isSameNode(document.activeElement));\n    let newFocusedIndex = 0;\n    if (currentFocusedIndex >= 0) {\n      if (e.shiftKey) {\n        newFocusedIndex = currentFocusedIndex > 0\n          ? currentFocusedIndex - 1\n          : focusableElements.length - 1;\n      } else {\n        newFocusedIndex = currentFocusedIndex < focusableElements.length - 1\n          ? currentFocusedIndex + 1\n          : 0;\n      }\n    }\n\n    focusableElements[newFocusedIndex].focus();\n  }\n\n  document.addEventListener('keydown', handleKeyDown, false);\n\n  return () => {\n    document.removeEventListener('keydown', handleKeyDown, false);\n  };\n}\n","import type { FC, VirtualElement } from '../../lib/teact/teact';\nimport { useRef, useLayoutEffect } from '../../lib/teact/teact';\nimport TeactDOM from '../../lib/teact/teact-dom';\n\ntype OwnProps = {\n  containerId?: string;\n  className?: string;\n  children: VirtualElement;\n};\n\nconst Portal: FC<OwnProps> = ({ containerId, className, children }) => {\n  const elementRef = useRef<HTMLDivElement>();\n  if (!elementRef.current) {\n    elementRef.current = document.createElement('div');\n  }\n\n  useLayoutEffect(() => {\n    const container = document.querySelector<HTMLDivElement>(containerId || '#portals');\n    if (!container) {\n      return undefined;\n    }\n\n    const element = elementRef.current!;\n    if (className) {\n      element.classList.add(className);\n    }\n\n    container.appendChild(element);\n\n    return () => {\n      TeactDOM.render(undefined, element);\n      container.removeChild(element);\n    };\n  }, [className, containerId]);\n\n  return TeactDOM.render(children, elementRef.current);\n};\n\nexport default Portal;\n","import { useLayoutEffect, useRef } from '../lib/teact/teact';\n\nconst useLayoutEffectWithPrevDeps = <const T extends readonly any[]>(\n  cb: (args: T | readonly []) => void, dependencies: T, debugKey?: string,\n) => {\n  const prevDepsRef = useRef<T>();\n\n  return useLayoutEffect(() => {\n    const prevDeps = prevDepsRef.current;\n    prevDepsRef.current = dependencies;\n\n    return cb(prevDeps || []);\n    // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n  }, dependencies, debugKey);\n};\n\nexport default useLayoutEffectWithPrevDeps;\n","type HandlerName =\n  'onEnter'\n  | 'onBackspace'\n  | 'onDelete'\n  | 'onEsc'\n  | 'onUp'\n  | 'onDown'\n  | 'onLeft'\n  | 'onRight'\n  | 'onTab';\ntype Handler = (e: KeyboardEvent) => void | boolean;\ntype CaptureOptions = Partial<Record<HandlerName, Handler>>;\n\nconst keyToHandlerName: Record<string, HandlerName> = {\n  Enter: 'onEnter',\n  Backspace: 'onBackspace',\n  Delete: 'onDelete',\n  Esc: 'onEsc',\n  Escape: 'onEsc',\n  ArrowUp: 'onUp',\n  ArrowDown: 'onDown',\n  ArrowLeft: 'onLeft',\n  ArrowRight: 'onRight',\n  Tab: 'onTab',\n};\n\nconst handlers: Record<HandlerName, Handler[]> = {\n  onEnter: [],\n  onDelete: [],\n  onBackspace: [],\n  onEsc: [],\n  onUp: [],\n  onDown: [],\n  onLeft: [],\n  onRight: [],\n  onTab: [],\n};\n\nexport default function captureKeyboardListeners(options: CaptureOptions) {\n  if (!hasActiveHandlers()) {\n    document.addEventListener('keydown', handleKeyDown, true);\n  }\n\n  (Object.keys(options) as Array<HandlerName>).forEach((handlerName) => {\n    const handler = options[handlerName];\n    if (!handler) {\n      return;\n    }\n\n    const currentEventHandlers = handlers[handlerName];\n    if (currentEventHandlers) {\n      currentEventHandlers.push(handler);\n    }\n  });\n\n  return () => {\n    releaseKeyboardListener(options);\n  };\n}\n\nfunction hasActiveHandlers() {\n  return Object.values(handlers).some((keyHandlers) => Boolean(keyHandlers.length));\n}\n\nfunction handleKeyDown(e: KeyboardEvent) {\n  const handlerName = keyToHandlerName[e.key];\n  if (!handlerName) {\n    return;\n  }\n\n  const { length } = handlers[handlerName];\n  if (!length) {\n    return;\n  }\n\n  for (let i = length - 1; i >= 0; i--) {\n    const handler = handlers[handlerName][i]!;\n    if (handler(e) !== false) {\n      e.stopPropagation();\n      break;\n    }\n  }\n}\n\nfunction releaseKeyboardListener(options: CaptureOptions) {\n  (Object.keys(options) as Array<HandlerName>).forEach((handlerName) => {\n    const handler = options[handlerName];\n    const currentEventHandlers = handlers[handlerName];\n    if (currentEventHandlers) {\n      const index = currentEventHandlers.findIndex((cb) => cb === handler);\n      if (index !== -1) {\n        currentEventHandlers.splice(index, 1);\n      }\n    }\n  });\n\n  if (!hasActiveHandlers()) {\n    document.removeEventListener('keydown', handleKeyDown, false);\n  }\n}\n","let counter = 0;\n\nexport function disableDirectTextInput() {\n  counter += 1;\n}\n\nexport function enableDirectTextInput() {\n  counter -= 1;\n}\n\nexport function getIsDirectTextInputDisabled() {\n  return counter > 0;\n}\n"],"names":["_ref","dialogRef","title","className","isOpen","isSlim","header","hasCloseButton","noBackdrop","noBackdropClose","children","style","onClose","onCloseAnimationEnd","onEnter","shouldSkipHistoryAnimations","shouldRender","transitionClassNames","useShowTransition","undefined","modalRef","useRef","useEffect","disableDirectTextInput","enableDirectTextInput","handleEnter","useLastCallback","e","preventDefault","captureKeyboardListeners","onEsc","current","element","handleKeyDown","key","stopPropagation","focusableElements","Array","from","querySelectorAll","length","currentFocusedIndex","findIndex","em","isSameNode","document","activeElement","newFocusedIndex","shiftKey","focus","addEventListener","removeEventListener","trapFocus","useHistoryBack","isActive","onBack","useLayoutEffectWithPrevDeps","_ref2","prevIsOpen","body","classList","toggle","Boolean","dispatchHeavyAnimationEvent","remove","lang","useLang","fullClassName","buildClassName","React","Portal","ref","tabIndex","role","onClick","Button","round","color","size","ariaLabel","containerId","elementRef","createElement","useLayoutEffect","container","querySelector","add","appendChild","TeactDOM","removeChild","cb","dependencies","debugKey","prevDepsRef","prevDeps","keyToHandlerName","Enter","Backspace","Delete","Esc","Escape","ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Tab","handlers","onDelete","onBackspace","onUp","onDown","onLeft","onRight","onTab","options","hasActiveHandlers","Object","keys","forEach","handlerName","handler","currentEventHandlers","push","index","splice","releaseKeyboardListener","values","some","keyHandlers","i","counter","getIsDirectTextInputDisabled"],"sourceRoot":""}